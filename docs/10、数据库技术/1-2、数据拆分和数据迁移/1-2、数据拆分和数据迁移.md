## 1. 垂直拆分
### 1.1. 为什么要垂直拆分？
&emsp;&emsp;单机数据库无法适应发展了，团队规模越来越大、单个数据库连接有限，数据库存储的b+树也是有极值的，主从会有高延迟，运维这么庞大的数据库耗费时间，比如备份数据非常耗时，恢复也是，开发团队访问同一数据库遇到很多实际的问题，比如操作一个库整个业务都可能受影响，于是垂直拆分横空出世。根据业务线拆分成不同的业务的数据库，比如订单库，用户库，支付库等等，如果需要访问该库的数据，直接调用该业务提供的服务即可。这样业务之间的职责更加明确，互补干扰，做到了解耦，而且能够扩展更大的资源，而且可以按需调整配置，最大化的利用资源，这个也最终演化成微服务架构。
### 1.2. 如何拆分？
梳理拆分的范围和影响，一小点一小点拆分，慢慢的拆完，先拆不重要的服务，运行看有没有问题，然后一步步来。
### 1.3. 会带来什么问题？
* 数据的聚合不像以前的关连查询那么方便了
* 事务问题
* 部署更加复杂了，以前只需要维护一个数据库，现在需要更多的数据库。
* 拆分对应用影响大，需要团队配合改代码
* 拆分是有极限的，比如不可能将两个订单和订单详情放在不同的库

## 2. 水平拆分
### 2.1. 水平拆分
分库和分表的区别，在一个mysql实例里分表和在一个实例里分库没有太多的区别，数据库的压力并没有分散，所以我们是尽量去在不同的实例上分库。当然如果数据库的资源足够，可以通过分表来降低单表的压力，提升性能；  

水平拆分优点：
* 可以提升容量
* 对应用的影响较小  

缺点：
* 可能导致一性问题
* 数据需要迁移
* 管理可能更加复杂  

可以将有事务关系的表放在一个库来减少出现一致性的问题。

### 2.2. 数据归档  
&emsp;&emsp;可以将数据分为热温冷冰数据，热点数据可能频繁的更新，可以放在配置好的数据库之中，温数据有查询需求但是不会被更新了可以放在配置一般的机器上，而冷数据就是查都不怎么查了，但是可能有特殊情况要查，放在差点的机器上，需要的时候去那个机器查询，而冰数据要么直接压缩打包或者删除就行。
## 3. ShardingSphereProxy
可以进行异构数据，满足不同维度的查询数据需求。
## 4. 数据迁移
### 4.1. 为啥要数据迁移
### 4.2. 数据迁移需要达到什么要求
### 4.3. 如何做数据迁移
#### 4.3.1. 全量数据迁移
* 直接dump，需要停机，如果有异构的需求则需要写程序
* 依赖数据库的更新时间，先迁移某一时间点之前的全量数据，然后停机更新，同步某一时间点到现在的数据，切换新数据源，这样能将影响调整到最小。
#### 4.3.2. 增量数据迁移
通过mysql的binlog日志同步数据，需要借助同步工具  
常用的工具有：
* ShardingSphere、
* Canal、
* Logstach、
* Datax
#### 4.3.3. ShardingSphere实践
&emsp;&emsp;ShardingSphere是一款分布式数据库解决方案组成的生态圈，由jdbc、proxy、sidecar三大组件组成。
* Jdbc  
  一款java访问数据库的框架，一款增强版本的jdbc驱动

* Proxy  
  数据库的代理，访问该代理就如同访问真实数据库一样。

* Sidecar（规划中）  
  定位为 Kubernetes 的云原生数据库代理，又可称数据库网格。

  
&emsp;&emsp;另外ShardingSphere-Scaling 是一个提供给用户的通用的 ShardingSphere 数据接入迁移，及弹性伸缩的解决方案  
该插件可以实现全量同步、增量同步、异构同步


## 5. 分布式数据库技术
### 5.1. 框架层面
* tddl
* shardingjdbc
### 5.2. 中间件层
* KingShard
* Cobar(阿里不维护了)
* Drds（商业的）
* Shardingproxy
* MyCat(前身 Coba)/DBLE
* Vitness
